function generateLaserTrajectory2(VerticesUnique, tolerance, numLaserSteps)
% generateLaserTrajectory2 - Computes, displays, and stores the horizontal laser trajectory
%                            including the return path.
%
% Syntax: generateLaserTrajectory2(VerticesUnique, tolerance, numLaserSteps)
%
% Inputs:
%   VerticesUnique - Unique tumour surface points (Nx3 matrix with columns [x, y, z]).
%   tolerance      - Offset (in mm) used in the bounding box computation.
%   numLaserSteps  - Number of steps for the forward (or return) cut.
%
% Description:
%   The function computes the tumour bounding box and defines the starting point for the
%   horizontal laser cut as (max_x, min_y, min_z). The laser beam (or "cut") is made by
%   moving its x-coordinate linearly from max_x to min_x while keeping y and z constant.
%   After reaching the minimum x position, the beam returns to the starting point along
%   the same line. The laser beam is assumed to be oriented horizontally with a fixed
%   orientation [theta_x, theta_y, theta_z] = [90, 0, 0] (degrees). Key messages are
%   inserted into the trajectory data. The complete round-trip trajectory is printed with
%   enhanced separators and stored in the base workspace as "laserPath2".

    % Compute bounding box from tumour data
    min_x = min(VerticesUnique(:,1));
    max_x = max(VerticesUnique(:,1));
    min_y = min(VerticesUnique(:,2));
    % Use the lowest z from the tumour data
    min_z = min(VerticesUnique(:,3));
    
    % Define starting point for horizontal laser cut:
    % (max_x, min_y, min_z)
    startPoint = [max_x, min_y, min_z];
    
    % Define end point for the forward cut (minimum x)
    endPoint = [min_x, min_y, min_z];
    
    % Forward cut: interpolate x from startPoint(1) to endPoint(1)
    x_forward = linspace(startPoint(1), endPoint(1), numLaserSteps)';
    % Return cut: interpolate x from endPoint(1) back to startPoint(1)
    x_return = linspace(endPoint(1), startPoint(1), numLaserSteps)';
    % Remove duplicate point (endPoint appears twice)
    x_return = x_return(2:end);
    
    % y and z remain constant for both segments
    y_forward = repmat(startPoint(2), numLaserSteps, 1);
    z_forward = repmat(startPoint(3), numLaserSteps, 1);
    
    y_return = repmat(startPoint(2), numLaserSteps-1, 1);
    z_return = repmat(startPoint(3), numLaserSteps-1, 1);
    
    % Combine forward and return segments
    x_values = [x_forward; x_return];
    y_values = [y_forward; y_return];
    z_values = [z_forward; z_return];
    
    % Total number of steps for the round trip
    numTotalSteps = length(x_values);
    
    % Fixed orientation for a horizontal beam pointing toward decreasing x:
    % Set theta_x = 90 deg (rotated to horizontal), theta_y = 0, theta_z = 0.
    fixedOrientation = [90, 0, 0];
    
    % Create cell array to hold the trajectory data.
    % Each row: {x, y, z, label, theta_x, theta_y, theta_z}
    laserPath2 = cell(numTotalSteps, 7);
    for i = 1:numTotalSteps
        laserPath2{i,1} = x_values(i);
        laserPath2{i,2} = y_values(i);
        laserPath2{i,3} = z_values(i);
        laserPath2{i,4} = ''; % label (to be updated below)
        laserPath2{i,5} = fixedOrientation(1);
        laserPath2{i,6} = fixedOrientation(2);
        laserPath2{i,7} = fixedOrientation(3);
    end
    
    % Insert key messages:
    laserPath2{1,4} = sprintf('Beginning of horizontal laser path at (%.4f, %.4f, %.4f).', ...
                              startPoint(1), startPoint(2), startPoint(3));
    laserPath2{numLaserSteps,4} = sprintf('Forward cut complete: reached minimum x = %.4f.', endPoint(1));
    laserPath2{numLaserSteps+1,4} = 'Laser is returning horizontally to start position.';
    laserPath2{end,4} = sprintf('Return complete: Laser is at start position (%.4f, %.4f, %.4f).', ...
                                startPoint(1), startPoint(2), startPoint(3));
    
    % Enhanced display separators for clearer output:
    separator = repmat('=', 1, 70);
    fprintf('\n%s\n', separator);
    disp('       *** HORIZONTAL LASER TRAJECTORY (ROUND TRIP) ***       ');
    fprintf('%s\n\n', separator);
    
    % Display the full trajectory in the command window:
    for i = 1:numTotalSteps
        fprintf('Step %d: x = %.4f, y = %.4f, z = %.4f, Orientation = [%.4f, %.4f, %.4f], Message: %s\n', ...
            i, laserPath2{i,1}, laserPath2{i,2}, laserPath2{i,3}, ...
            laserPath2{i,5}, laserPath2{i,6}, laserPath2{i,7}, laserPath2{i,4});
    end
    fprintf('\n%s\n\n', separator);
    
    % Store the trajectory in the MATLAB base workspace as "laserPath2"
    assignin('base', 'laserPath2', laserPath2);
end
